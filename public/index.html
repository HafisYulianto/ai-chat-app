<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ðŸ¤– AI Chat App</title>
  <meta name="description" content="AI Chat Mini App â€” TailwindCSS + Vanilla JS + Express + Gemini">
  <link rel="icon" href="data:image/svg+xml,\
  <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>\
    <text y='.9em' font-size='90'>ðŸ¤–</text></svg>">

  <!-- 1) Terapkan tema tersimpan lebih awal (mencegah flash) -->
  <script>
    try {
      const t = localStorage.getItem('ai-chat-theme') || 'light';
      if (t === 'dark') document.documentElement.classList.add('dark');
    } catch(_) {}
  </script>

  <!-- 2) Load Tailwind CDN terlebih dulu -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 3) BARU set konfigurasi Tailwind (dark mode berbasis class) -->
  <script>
    tailwind.config = {
      darkMode: 'class'
    };
  </script>

  <!-- Style tambahan -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body class="h-full bg-gray-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100">
  <div class="min-h-full flex flex-col">
    <!-- Header -->
    <header class="sticky top-0 z-10 backdrop-blur bg-white/80 dark:bg-gray-900/80 border-b border-gray-200 dark:border-gray-800">
      <div class="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span class="text-2xl">ðŸ¤–</span>
          <h1 class="font-semibold text-lg">AI Chat App</h1>
        </div>

        <div class="flex items-center gap-2">
          <button id="exportTxtBtn" class="btn-subtle" title="Export ke .txt">Export .txt</button>
          <button id="exportPdfBtn" class="btn-subtle" title="Export ke .pdf">Export .pdf</button>
          <button id="resetBtn" class="btn-subtle" title="Hapus semua riwayat chat">Reset</button>
          <button id="themeToggle" class="btn-icon" title="Toggle Dark/Light">

            <!-- Ikon tersinkron via script.js -->
            <svg id="sunIcon" class="w-5 h-5 hidden dark:inline" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M6.76 4.84l-1.8-1.79L3.17 4.84l1.79 1.8 1.8-1.8zm10.48 0l1.8-1.79 1.79 1.79-1.79 1.8-1.8-1.8zM12 4V1h0v3h0zm0 19v-3h0v3h0zM4 12H1v0h3v0zm19 0h-3v0h3v0zM6.76 19.16l-1.8 1.79-1.79-1.79 1.79-1.8 1.8 1.8zm10.48 0l1.8 1.79 1.79-1.79-1.79-1.8-1.8 1.8zM12 7a5 5 0 100 10 5 5 0 000-10z"/>
            </svg>
            <svg id="moonIcon" class="w-5 h-5 dark:hidden" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Chat area -->
    <main class="flex-1">
      <div id="chatContainer" class="max-w-3xl mx-auto px-4 py-4 space-y-3 overflow-y-auto">
        <!-- Bubbles di-inject oleh script.js -->
      </div>
    </main>

    <!-- Input bar -->
    <footer class="sticky bottom-0 bg-white/80 dark:bg-gray-900/80 border-t border-gray-200 dark:border-gray-800">
      <form id="chatForm" class="max-w-3xl mx-auto px-4 py-3 flex items-end gap-2">
        <button id="emojiBtn" type="button" class="btn-icon" title="Emoji">ðŸ˜Š</button>
        <textarea id="userInput" rows="1"
          placeholder="Tulis pertanyaan kamuâ€¦"
          class="flex-1 resize-none rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-teal-500"
          maxlength="500" required></textarea>
        <button id="sendBtn" type="submit" class="btn-primary flex items-center gap-2">
          <span id="sendBtnText">Kirim</span>
          <svg id="sendSpinner" class="w-4 h-4 animate-spin hidden" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
          </svg>
        </button>
      </form>
    </footer>
  </div>

  <!-- Templates -->
  <template id="bubbleUser">
    <div class="flex justify-end">
      <div class="bubble bubble-user">
        <p class="whitespace-pre-wrap"></p>
        <span class="time"></span>
      </div>
    </div>
  </template>

  <template id="bubbleAI">
    <div class="flex justify-start">
      <div class="bubble bubble-ai">
        <p class="whitespace-pre-wrap"></p>
        <span class="time"></span>
      </div>
    </div>
  </template>

  <template id="typingTpl">
    <div id="typingIndicator" class="flex justify-start">
      <div class="bubble bubble-ai !opacity-80">
        <span class="typing-dots" aria-label="AI sedang mengetik" title="AI sedang mengetik">
          <span></span><span></span><span></span>
        </span>
      </div>
    </div>
  </template>

  <script src="./script.js" defer></script>
</body>
</html>
